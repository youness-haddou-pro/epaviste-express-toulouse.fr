---
const { phone } = Astro.props as { phone: string };
---

<section id="process" class="relative bg-gray-50">
  <!-- déco discrète -->
  <div class="pointer-events-none absolute inset-x-0 top-0 -z-10 h-28 bg-gradient-to-b from-emerald-100/60 to-transparent opacity-70"></div>

  <div class="mx-auto max-w-6xl px-6 py-16">
    <header class="mb-10">
      <h2 class="text-2xl font-bold tracking-tight md:text-3xl">Comment ça marche ?</h2>
    </header>

    <ol class="grid gap-6 sm:grid-cols-3">
      <!-- Étape 1 -->
      <li
        class="step-card reveal group relative overflow-hidden rounded-2xl bg-white p-6 shadow-sm ring-1 ring-gray-200
               transition duration-300 hover:-translate-y-1 hover:shadow-xl"
        style="--delay:0ms"
      >
        <!-- connecteur (vertical mobile / horizontal desktop) -->
        <span class="pointer-events-none absolute left-1/2 top-full hidden h-6 w-px -translate-x-1/2 bg-gradient-to-b from-emerald-200 to-transparent sm:block sm:h-px sm:w-12 sm:left-full sm:top-1/2 sm:-translate-x-0 sm:-translate-y-1/2 sm:bg-gradient-to-r"></span>

        <!-- bordure gradient -->
        <div class="pointer-events-none absolute inset-0 rounded-2xl opacity-0 transition-opacity duration-300 group-hover:opacity-100"
             style="mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
                    -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
                    -webkit-mask-composite: xor; mask-composite: exclude; padding:1px;
                    background:linear-gradient(120deg, rgba(16,185,129,.55), rgba(16,185,129,.12), rgba(16,185,129,.55));"></div>

        <!-- spotlight -->
        <div class="pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-300 group-hover:opacity-100"
             style="background: radial-gradient(360px circle at var(--x,50%) var(--y,50%), rgba(16,185,129,.08), transparent 40%);"></div>

        <span class="relative z-10 inline-flex h-9 w-9 items-center justify-center rounded-full bg-emerald-600 font-bold text-white shadow ring-2 ring-emerald-200 transition-transform duration-300 group-hover:scale-110">
          1
        </span>
        <p class="relative z-10 mt-3 font-semibold">Appelez <a href={`tel:${phone}`} class="underline decoration-emerald-300 underline-offset-4 hover:text-emerald-700">{phone}</a></p>
        <p class="relative z-10 mt-1 text-sm text-gray-600">Créneau d’appel privilégié : 9h–22h.</p>
      </li>

      <!-- Étape 2 -->
      <li
        class="step-card reveal group relative overflow-hidden rounded-2xl bg-white p-6 shadow-sm ring-1 ring-gray-200
               transition duration-300 hover:-translate-y-1 hover:shadow-xl"
        style="--delay:100ms"
      >
        <!-- connecteur (vers la 3e) -->
        <span class="pointer-events-none absolute left-1/2 top-full hidden h-6 w-px -translate-x-1/2 bg-gradient-to-b from-emerald-200 to-transparent sm:block sm:h-px sm:w-12 sm:left-full sm:top-1/2 sm:-translate-x-0 sm:-translate-y-1/2 sm:bg-gradient-to-r"></span>

        <div class="pointer-events-none absolute inset-0 rounded-2xl opacity-0 transition-opacity duration-300 group-hover:opacity-100"
             style="mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
                    -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
                    -webkit-mask-composite: xor; mask-composite: exclude; padding:1px;
                    background:linear-gradient(120deg, rgba(16,185,129,.55), rgba(16,185,129,.12), rgba(16,185,129,.55));"></div>
        <div class="pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-300 group-hover:opacity-100"
             style="background: radial-gradient(360px circle at var(--x,50%) var(--y,50%), rgba(16,185,129,.08), transparent 40%);"></div>

        <span class="relative z-10 inline-flex h-9 w-9 items-center justify-center rounded-full bg-emerald-600 font-bold text-white shadow ring-2 ring-emerald-200 transition-transform duration-300 group-hover:scale-110">
          2
        </span>
        <p class="relative z-10 mt-3 font-semibold">RDV rapide</p>
        <p class="relative z-10 mt-1 text-sm text-gray-600">Intervention en 1–2 h selon votre emplacement.</p>
      </li>

      <!-- Étape 3 -->
      <li
        class="step-card reveal group relative overflow-hidden rounded-2xl bg-white p-6 shadow-sm ring-1 ring-gray-200
               transition duration-300 hover:-translate-y-1 hover:shadow-xl"
        style="--delay:200ms"
      >
        <div class="pointer-events-none absolute inset-0 rounded-2xl opacity-0 transition-opacity duration-300 group-hover:opacity-100"
             style="mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
                    -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
                    -webkit-mask-composite: xor; mask-composite: exclude; padding:1px;
                    background:linear-gradient(120deg, rgba(16,185,129,.55), rgba(16,185,129,.12), rgba(16,185,129,.55));"></div>
        <div class="pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-300 group-hover:opacity-100"
             style="background: radial-gradient(360px circle at var(--x,50%) var(--y,50%), rgba(16,185,129,.08), transparent 40%);"></div>

        <span class="relative z-10 inline-flex h-9 w-9 items-center justify-center rounded-full bg-emerald-600 font-bold text-white shadow ring-2 ring-emerald-200 transition-transform duration-300 group-hover:scale-110">
          3
        </span>
        <p class="relative z-10 mt-3 font-semibold">Enlèvement & papiers</p>
        <p class="relative z-10 mt-1 text-sm text-gray-600">Enlèvement &lt; 20 min, certificat de destruction fourni.</p>
      </li>
    </ol>

    <!-- CTA -->
    <div class="mt-8 flex flex-wrap items-center gap-3">
      <a href={`tel:${phone}`} class="inline-flex items-center gap-2 rounded-2xl bg-emerald-600 px-5 py-3 font-semibold text-white shadow-md transition hover:-translate-y-0.5 hover:shadow-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500">
        Appeler maintenant
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          class="h-5 w-5"
          aria-hidden="true"
          focusable="false"
          fill="currentColor"
        >
          <path d="M2.25 3.75A1.5 1.5 0 0 1 3.75 2.25h2.77c.63 0 1.2.4 1.4.98l.99 2.85c.18.52.05 1.1-.34 1.5l-1.7 1.7a16.76 16.76 0 0 0 7.12 7.12l1.7-1.7c.4-.39.98-.52 1.5-.34l2.85.99c.58.2.98.77.98 1.4v2.77a1.5 1.5 0 0 1-1.5 1.5H18c-8.56 0-15.5-6.94-15.5-15.5v-1.5z"/>
        </svg>
      </a>
      <span class="text-sm text-gray-500 uppercase">9h–22h, 7j/7</span>
    </div>
  </div>
</section>

<style is:global>
/* reveal au scroll + délai via --delay */
.reveal { opacity: 0; transform: translateY(8px); transition: opacity .45s ease, transform .45s ease; transition-delay: var(--delay, 0ms); }
.reveal.is-inview { opacity: 1; transform: translateY(0); }
.step-card { cursor: pointer }

@media (prefers-reduced-motion: reduce) {
  .reveal { opacity: 1; transform: none; transition: none; }
  .step-card { transition: none !important; }
}
</style>

<script>
  // Reveal au scroll
  const io = new IntersectionObserver((entries) => {
    entries.forEach(e => {
      if (e.isIntersecting) {
        e.target.classList.add('is-inview');
        io.unobserve(e.target);
      }
    });
  }, { threshold: 0.18 });
  document.querySelectorAll('.reveal').forEach(el => io.observe(el));

  // Spotlight (suit la souris)
  document.querySelectorAll('.step-card').forEach((card) => {
    card.addEventListener('mousemove', (e) => {
      const r = card.getBoundingClientRect();
      const x = ((e.clientX - r.left) / r.width) * 100;
      const y = ((e.clientY - r.top) / r.height) * 100;
      card.style.setProperty('--x', x + '%');
      card.style.setProperty('--y', y + '%');
    });
    card.addEventListener('mouseleave', () => {
      card.style.removeProperty('--x'); card.style.removeProperty('--y');
    });
  });
</script>
